<?php

namespace Modules\Integration\Console;

use Illuminate\Console\Command;
use Illuminate\Support\Facades\Log;
use Modules\Integration\Contracts\IntegrationServiceContract;
use Modules\Integration\Entities\Integration;
use Modules\Integration\Exceptions\IntegrationException;

class ActivateAccidentallyDeactivatedIntegrations extends Command
{
    protected $signature = 'activate-accidentally-deactivated-integrations';

    public function handle()
    {
        $json = '[40760,40761,40762,40763,40765,40766,40769,40770,40772,40773,40777,40792,40805,40816,40823,40826,40833,40834,40846,40847,40856,40858,40863,40864,40865,40871,40873,40874,40880,40883,40884,40885,40888,40890,40891,40892,40893,40896,40897,40900,40901,40902,40906,40908,40910,40913,40914,40921,40922,40923,40924,40929,40937,40939,40940,40941,40945,40946,40947,40953,40954,40955,40957,40961,40962,40973,40974,40979,40980,40981,40984,40987,40988,40989,40991,40992,40993,40994,40995,40996,40999,41001,41002,41011,41018,41019,41020,41029,41032,41042,41047,41054,41057,41058,41059,41060,41071,41073,41077,41094,41097,41098,41101,41104,41112,41122,41124,41136,41154,41157,41163,41164,41165,41166,41167,41168,41171,41180,41184,41187,41188,41198,41211,41221,41227,41229,41234,41237,41238,41239,41244,41252,41253,41257,41259,41260,41268,41271,41276,41281,41284,41292,41304,41307,41318,41326,41328,41339,41357,41359,41360,41374,41378,41379,41381,41384,41397,41399,41402,41404,41407,41408,41421,41422,41427,41428,41430,41435,41437,41440,41446,41447,41448,41450,41451,41460,41465,41470,41473,41481,41484,41485,41487,41489,41493,41494,41506,41509,41510,41511,41512,41516,41517,41518,41525,41526,41529,41531,41533,41552,41565,41566,41567,41572,41573,41576,41596,41598,41599,41602,41607,41610,41611,41613,41621,41627,41633,41637,41642,41644,41647,41648,41650,41651,41652,41653,41661,41669,41674,41675,41676,41680,41682,41697,41702,41708,41713,41716,41718,41727,41729,41733,41737,41738,41742,41743,41752,41756,41758,41759,41761,41762,41768,41771,41779,41782,41785,41790,41791,41802,41806,41811,41812,41813,41815,41817,41818,41819,41822,41826,41833,41834,41835,41842,41843,41844,41850,41860,41871,41873,41876,41878,41883,41884,41885,41886,41890,41896,41900,41910,41911,41912,41914,41916,41917,41920,41921,41922,41923,41925,41926,41927,41931,41934,41942,41957,41960,41964,41965,41969,41973,41974,41975,41978,41979,41981,41983,41984,41986,41991,41993,42005,42007,42026,42028,42031,42032,42033,42034,42045,42054,42055,42057,42058,42061,42062,42063,42065,42068,42079,42081,42083,42085,42088,42093,42094,42107,42109,42126,42130,42132,42134,42140,42141,42150,42155,42158,42168,42171,42172,42174,42180,42182,42188,42189,42190,42191,42192,42194,42196,42199,42201,42208,42210,42212,42213,42214,42215,42220,42222,42223,42224,42226,42227,42228,42229,42230,42233,42235,42242,42244,42245,42246,42248,42249,42250,42263,42266,42267,42272,42275,42283,42288,42289,42293,42299,42306,42312,42313,42317,42318,42320,42321,42326,42331,42338,42340,42350,42357,42359,42360,42361,42369,42371,42380,42388,42398,42399,42400,42401,42406,42407,42408,42409,42410,42411,42413,42437,42438,42439,42441,42442,42449,42451,42452,42465,42473,42478,42488,42494,42495,42500,42503,42504,42509,42510,42511,42513,42514,42526,42528,42530,42535,42539,42540,42548,42551,42556,42558,42560,42563,42564,42566,42567,42568,42574,42587,42589,42590,42593,42598,42599,42610,42619,42631,42635,42636,42638,42640,42641,42644,42645,42647,42657,42675,42681,42682,42687,42688,42691,42694,42699,42700,42701,42702,42706,42713,42716,42718,42719,42721,42722,42725,42726,42727,42732,42735,42738,42740,42754,42756,42761,42763,42764,42765,42767,42768,42769,42770,42771,42772,42777,42778,42784,42788,42791,42793,42794,42795,42797,42799,42804,42805,42806,42807,42808,42809,42811,42813,42819,42820,42823,42825,42828,42829,42830,42835,42837,42838,42839,42843,42847,42848,42849,42850,42852,42854,42857,42865,42867,42868,42869,42870,42871,42872,42875,42881,42882,42885,42888,42890,42891,42892,42893,42899,42900,42901,42908,42911,42921,42926,42932,42941,42943,42944,42945,42948,42949,42950,42951,42952,42954,42955,42960,42966,42968,42977,42984,42998,43000,43001,43004,43006,43008,43009,43012,43013,43017,43030,43033,43036,43039,43051,43053,43055,43058,43060,43069,43079,43083,43089,43091,43107,43108,43109,43111,43112,43113,43115,43119,43120,43121,43122,43124,43125,43126,43127,43128,43130,43131,43133,43136,43140,43145,43146,43147,43150,43151,43152,43153,43158,43159,43162,43180,43183,43185,43187,43197,43201,43202,43203,43205,43210,43215,43227,43228,43230,43231,43232,43236,43238,43240,43241,43242,43244,43245,43246,43247,43255,43256,43257,43258,43261,43262,43271,43272,43278,43287,43288,43293,43294,43295,43303,43304,43305,43307,43309,43311,43317,43321,43322,43323,43324,43325,43326,43329,43337,43339,43340,43346,43352,43354,43357,43358,43360,43362,43364,43379,43380,43383,43386,43388,43390,43391,43393,43394,43406,43407,43408,43410,43411,43412,43414,43415,43423,43428,43429,43431,43436,43446,43447,43468,43469,43470,43475,43476,43477,43478,43480,43481,43487,43488,43501,43506,43508,43513,43521,43526,43528,43530,43531,43534,43535,43537,43547,43553,43555,43561,43562,43563,43564,43567,43568,43570,43572,43573,43574,43580,43582,43585,43586,43591,43593,43594,43601,43602,43606,43607,43610,43612,43627,43635,43636,43648,43649,43654,43656,43658,43659,43664,43683,43686,43690,43692,43696,43698,43699,43701,43702,43703,43708,43710,43712,43721,43724,43728,43729,43730,43735,43760,43766,43769,43779,43781,43785,43786,43792,43793,43796,43803,43805,43809,43816,43818,43819,43820,43821,43826,43828,43831,43832,43836,43837,43839,43840,43841,43844,43845,43846,43847,43848,43857,43858,43859,43860,43862,43865,43871,43873,43878,43879,43880,43885,43888,43889,43890,43891,43892,43893,43894,43895,43896,43897,43900,43906,43909,43911,43915,43918,43923,43924,43925,43926,43928,43930,43934,43935,43938,43939,43941,43945,43946,43947,43948,43955,43959,43967,43969,43975,43976,43981,43986,43988,43989,43991,43993,43994,43996,43997,43998,44002,44023,44024,44031,44032,44033,44034,44035,44036,44037,44038,44039,44040,44044,44047,44048,44051,44052,44054,44062,44077,44088,44089,44091,44093,44096,44097,44102,44106,44111,44112,44118,44119,44124,44127,44131,44133,44135,44145,44147,44148,44149,44150,44157,44158,44160,44164,44170,44172,44174,44175,44176,44179,44204,44211,44218,44226,44229,44230,44231,44239,44244,44246,44256,44258,44262,44263,44266,44272,44274,44279,44281,44284,44285,44286,44287,44290,44295,44301,44312,44313,44314,44317,44318,44322,44323,44326,44327,44333,44336,44337,44343,44345,44346,44348,44349,44351,44359,44361,44363,44369,44372,44378,44382,44384,44390,44391,44392,44393,44394,44397,44404,44412,44413,44420,44422,44423,44429,44434,44437,44439,44447,44450,44452,44453,44454,44456,44457,44461,44471,44472,44473,44474,44475,44476,44477,44489,44490,44491,44492,44493,44494,44500,44502,44504,44506,44507,44520,44522,44524,44525,44526,44528,44529,44530,44532,44533,44535,44538,44539,44543,44545,44555,44556,44559,44560,44561,44566,44570,44571,44572,44577,44583,44584,44586,44608,44619,44620,44621,44624,44629,44647,44652,44658,44659,44662,44663,44678,44679,44680,44681,44688,44698,44700,44702,44703,44708,44709,44716,44734,44736,44742,44752,44755,44762,44763,44764,44767,44784,44785,44786,44789,44791,44792,44797,44803,44804,44805,44806,44807,44812,44813,44829,44831,44833,44836,44840,44844,44846,44849,44850,44852,44859,44863,44865,44868,44873,44878,44885,44887,44894,44898,44899,44901,44902,44910,44918,44919,44925,44930,44932,44933,44934,44941,44942,44943,44944,44945,44950,44951,44952,44953,44958,44959,44960,44961,44962,44966,44968,44969,44973,44985,44990,44992,44995,45010,45014,45016,45017,45033,45045,45046,45049,45050,45053,45059,45061,45067,45071,45073,45075,45076,45077,45079,45083,45084,45086,45087,45093,45094,45101,45102,45105,45110,45124,45125,45126,45132,45140,45144,45145,45152,45157,45158,45160,45164,45166,45167,45168,45171,45178,45182,45186,45187,45196,45198,45200,45201,45209,45210,45216,45217,45219,45220,45221,45222,45224,45225,45226,45228,45229,45230,45234,45235,45236,45237,45238,45239,45241,45245,45246,45251,45267,45268,45269,45271,45274,45276,45277,45279,45280,45281,45282,45284,45286,45287,45288,45295,45301,45304,45305,45306,45308,45311,45316,45317,45318,45319,45320,45321,45327,45338,45342,45343,45344,45346,45348,45350,45352,45353,45355,45356,45357,45359,45361,45362,45363,45364,45365,45366,45367,45368,45369,45374,45376,45377,45382,45386,45387,45388,45389,45390,45391,45393,45396,45408,45411,45412,45413,45416,45418,45419,45423,45426,45427,45431,45432,45433,45435,45437,45439,45440,45447,45449,45450,45452,45454,45455,45461,45462,45463,45465,45466,45467,45468,45469,45470,45477,45479,45481,45485,45486,45487,45499,45500,45501,45502,45503,45504,45505,45506,45509,45511,45524,45534,45536,45537,45540,45543,45544,45545,45550,45553,45558,45567,45574,45576,45578,45582,45585,45587,45589,45593,45594,45596,45608,45610,45611,45618]';
        $decodedJson = json_decode($json, true);
        $integrations = Integration::query()->where('active', false)->whereIn('id', $decodedJson)->get();

        foreach ($integrations as $integration) {
            $integrationService = app()->makeWith(IntegrationServiceContract::class, [
                'integration' => $integration
            ]);
            try {
                $integration->flushCache();
                $activated = $integrationService->activate(getCommandName());
                if($activated) {
                    Log::channel('integrations')->info('Integration activated.');
                    $this->info('Integration '.$integration->id.' activated.');
                } else {
                    Log::channel('integrations')->warning('Integration is not activated.');
                    $this->warn('Integration '.$integration->id.' is not activated.');
                }
            } catch (\Throwable $e) {
                Log::channel('integrations')->warning('Error: '. $e->getMessage());
                Log::channel('integrations')->warning('Integration is not activated.');
                $this->warn('Integration '.$integration->id.' is not activated. Error:'. $e->getMessage());
            }
        }
    }
}
